<?xml version='1.0' encoding='UTF-8'?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- Expired Documents -->
	<bean id="expiredDocuments"
		class="es.caib.gdib.schedulejobs.ExpiredDocuments">
		<property name="nodeService" ref="NodeService" />
		<property name="searchService" ref="SearchService" />
		<property name="dictionaryService" ref="DictionaryService" />
 		<property name="typeDoc" value="$gdib{expire.type_doc}" />
		<property name="attrib" value="$gdib{expire.attrib}" />
		<property name="changeAttrib" value="$gdib{expire.changeattrib}" />
		<property name="attribValue" value="$gdib{expire.attribvalue}" />
		<property name="luceneQuery" value="$gdib{expire.lucene.query}" />
		<property name="active" value="$gdib{expire.active}" />
	</bean>

	 <bean id="expiredDocumentsSchedulerAccessor" class="org.alfresco.schedule.AlfrescoSchedulerAccessorBean" > 
        <property name="scheduler" ref="schedulerFactory"/>
        <property name="triggers">
            <list>
                <bean id="expiredDocumentsTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
                    <property name="cronExpression" value="$gdib{expire.cron}"/>
                    <property name="jobDetail" ref="expiredDocumentsJobDetail"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="expiredDocumentsJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
        <property name="jobClass" value="es.caib.gdib.schedulejobs.ExpiredDocumentsJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="jobExecuter" value-ref="expiredDocuments"/>
            </map>
        </property>
    </bean>
    <!-- Fin Expired Documents -->

    <!-- Resealing Documents -->
    <bean id="resealDocuments"
		class="es.caib.gdib.schedulejobs.ResealDocuments" parent="baseJavaScriptExtension">
		<property name="resealDocumentsPropertiesFilter" ref="resealDocumentsPlaceHolderPopertiesFilter" />
		<property name="nodeService" ref="NodeService" />
		<property name="searchService" ref="SearchService" />
		<property name="utils" ref="gdibUtils"/>
		<property name="exUtils" ref="exUtils"/>
		<property name="subTypeDocUtil" ref="subTypeDocUtil" />
		<property name="typeDoc" value="$gdib{reseal.type_doc}" />
		<property name="active" value="$gdib{reseal.active}" />
		<property name="signatureTypeArchivedToUpgrade" value="$gdib{reseal.signature_types_archived_to_upgrade}" />
		<property name="signatureService" ref="internalSignatureService" />
		<property name="txnHelper" ref="retryingTransactionHelper" />
		<property name="extensionName" value="resealDocuments" />
	</bean>

	<bean id="resealDocumentsSchedulerAccessor" class="org.alfresco.schedule.AlfrescoSchedulerAccessorBean">
        <property name="scheduler" ref="schedulerFactory"/>
        <property name="triggers">
            <list>
                <bean id="resealDocumentsTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
                    <property name="cronExpression" value="$gdib{reseal.cron}"/>
                    <property name="jobDetail" ref="resealDocumentsJobDetail"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="resealDocumentsJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
        <property name="jobClass" value="es.caib.gdib.schedulejobs.ResealDocumentsJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="jobExecuter" value-ref="resealDocuments"/>
            </map>
        </property>
    </bean>

	<bean id="resealDocumentsPlaceHolderPopertiesFilter" class="es.caib.gdib.utils.FilterPlaceholderProperties">
		<constructor-arg index="0" type="String" value="reseal"/>
		<property name="ignoreUnresolvablePlaceholders">
			<value>true</value>
		</property>
		<property name="locations">
		        <list>
		        	<value>classpath:alfresco/module/gdib-amp/properties/schedule-job-reseal.properties</value>
		        	<value>classpath*:schedule-job-reseal.properties</value>
		        </list>
    		</property>
	</bean>

    <!-- Fin Resealing Documents -->
    <!-- UpgradeIndexJob -->
    <bean id="upgradeIndex"
		class="es.caib.gdib.schedulejobs.UpgradeIndex">
		<property name="upgradeIndexPropertiesFilter" ref="upgradeIndexPlaceHolderPopertiesFilter" />
		<property name="nodeService" ref="NodeService" />
		<property name="searchService" ref="SearchService" />
		<property name="subTypeDocUtil" ref="subTypeDocUtil" />
		<property name="importUtils" ref="importUtils" />
		<property name="signatureService" ref="internalSignatureService" />
		<property name="exportUtils" ref="exportUtils" />
		<property name="fileFolderService" ref="FileFolderService" />
		<property name="active" value="$gdib{upgrade.active}" />
		<property name="lucene_query" value="$gdib{upgrade.lucene_query}" />
		<property name="end_hour" value="$gdib{upgrade.end_hour}" />
		<property name="start_hour" value="$gdib{upgrade.start_hour}" />
		<property name="max_items" value="$gdib{upgrade.max_items}" />
		<property name="cert_serial" value="$gdib{upgrade.cert_serial}" />
		
		<property name="tmpDir" value="$gdib{gdib.repository.temp.folder.uuid}" />
		
	</bean>
	
	<bean id="upgradeIndexSchedulerAccessor" class="org.alfresco.schedule.AlfrescoSchedulerAccessorBean">
        <property name="scheduler" ref="schedulerFactory"/>
        <property name="triggers">
            <list>
                <bean id="upgradeIndexTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
                    <property name="cronExpression" value="$gdib{upgrade.cron}"/>
                    <property name="jobDetail" ref="upgradeIndexJobDetail"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="upgradeIndexJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
        <property name="jobClass" value="es.caib.gdib.schedulejobs.UpgradeIndexJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="jobExecuter" value-ref="upgradeIndex"/>
            </map>
        </property>
    </bean>
	<bean id="upgradeIndexPlaceHolderPopertiesFilter" class="es.caib.gdib.utils.FilterPlaceholderProperties">
		<constructor-arg index="0" type="String" value="upgrade"/>
		<property name="ignoreUnresolvablePlaceholders">
			<value>true</value>
		</property>
		<property name="locations">
		        <list>
		        	<value>classpath:alfresco/module/gdib-amp/properties/schedule-job-upgrade.properties</value>
		        	<value>classpath*:schedule-job-upgrade.properties</value>
		        </list>
    		</property>
	</bean>

<!--	fin del upgradeIndex-->
<!--Comienzo upgradeSignature-->
	<bean id="upgradeSignature"
		  class="es.caib.gdib.schedulejobs.UpgradeSignature">
		<property name="signatureService" ref="internalSignatureService" />
		<property name="bbddService" ref="asynchronousDatabaseAccess" />
		<property name="exUtils" ref="exUtils"/>
		<property name="utils" ref="gdibUtils"/>
		<property name="active" value="$gdib{upgrade.signature.upgrade.active}" />
		<property name="maxTries" value="$gdib{upgrade.signature.max.number.tries}" />
		<property name="destinations" value="$gdib{upgrade.signature.destination.mail}" />
		<property name="mailService" ref="MailService" />

	</bean>

	<bean id="upgradeSignatureSchedulerAccessor" class="org.alfresco.schedule.AlfrescoSchedulerAccessorBean">
		<property name="scheduler" ref="schedulerFactory"/>
		<property name="triggers">
			<list>
				<bean id="upgradeSignatureTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
					<property name="cronExpression" value="$gdib{upgrade.signature.upgrade.cron}"/>
					<property name="jobDetail" ref="upgradeSignatureJobDetail"/>
				</bean>
			</list>
		</property>
	</bean>

	<bean id="upgradeSignatureJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="es.caib.gdib.schedulejobs.UpgradeSignatureJob"/>
		<property name="jobDataAsMap">
			<map>
				<entry key="jobExecuter" value-ref="upgradeSignature"/>
			</map>
		</property>
	</bean>
	<bean id="upgradeSignaturePlaceHolderPopertiesFilter" class="es.caib.gdib.utils.FilterPlaceholderProperties">
		<constructor-arg index="0" type="String" value="upgrade"/>
		<property name="ignoreUnresolvablePlaceholders">
			<value>true</value>
		</property>
		<property name="locations">
			<list>
				<value>classpath:alfresco/module/gdib-amp/properties/schedule-job-upgrade-signature.properties</value>
				<value>classpath*:schedule-job-upgrade-signature.properties</value>
			</list>
		</property>
	</bean>

<!--	fin del upgradeSignature-->
<!--	closeFile-->
	<bean id="closeFile"
		  class="es.caib.gdib.schedulejobs.CloseFile">
		<property name="signatureService" ref="internalSignatureService" />
		<property name="bbddService" ref="asynchronousDatabaseAccess" />
		<property name="utils" ref="gdibUtils"/>
		<property name="active" value="$gdib{close.file.upgrade.active}" />
		<property name="maxTries" value="$gdib{close.file.max.number.tries}" />
		<property name="destinations" value="$gdib{close.file.destination.mail}" />
		<property name="addIntExchangeFilesPropValue" value="$gdib{gdib.repository.custody.exp.caibIndexV10.addExchangeFiles}" />
		<property name="mailService" ref="MailService" />
	</bean>

	<bean id="closeFileSchedulerAccessor" class="org.alfresco.schedule.AlfrescoSchedulerAccessorBean">
		<property name="scheduler" ref="schedulerFactory"/>
		<property name="triggers">
			<list>
				<bean id="closeFileTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
					<property name="cronExpression" value="$gdib{close.file.upgrade.cron}"/>
					<property name="jobDetail" ref="closeFileJobDetail"/>
				</bean>
			</list>
		</property>
	</bean>

	<bean id="closeFileJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
		<property name="jobClass" value="es.caib.gdib.schedulejobs.CloseFileJob"/>
		<property name="jobDataAsMap">
			<map>
				<entry key="jobExecuter" value-ref="closeFile"/>
			</map>
		</property>
	</bean>
	<bean id="closeFilePlaceHolderPopertiesFilter" class="es.caib.gdib.utils.FilterPlaceholderProperties">
		<constructor-arg index="0" type="String" value="upgrade"/>
		<property name="ignoreUnresolvablePlaceholders">
			<value>true</value>
		</property>
		<property name="locations">
			<list>
				<value>classpath:alfresco/module/gdib-amp/properties/schedule-job-close-file.properties</value>
				<value>classpath*:schedule-job-close-file.properties</value>
			</list>
		</property>
	</bean>
<!--	fin closeFile-->
	<!-- Expurgate Documents -->
    <bean id="expurgateDocuments"
		class="es.caib.gdib.schedulejobs.ExpurgateDocuments">
		<property name="expurgateDocumentsPropertiesFilter" ref="expurgateDocumentsPlaceHolderPopertiesFilter" />
		<property name="nodeService" ref="NodeService" />
		<property name="searchService" ref="SearchService" />
		<property name="dictionaryService" ref="DictionaryService" />
		<property name="subTypeDocUtil" ref="subTypeDocUtil" />
		<property name="active" value="$gdib{expurgate.active}" />
	</bean>

	<bean id="expurgateDocumentsSchedulerAccessor" class="org.alfresco.schedule.AlfrescoSchedulerAccessorBean">
        <property name="scheduler" ref="schedulerFactory"/>
        <property name="triggers">
            <list>
                <bean id="expurgateDocumentsTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">
                    <property name="cronExpression" value="$gdib{expurgate.cron}"/>
                    <property name="jobDetail" ref="expurgateDocumentsJobDetail"/>
                </bean>
            </list>
        </property>
    </bean>

    <bean id="expurgateDocumentsJobDetail" class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
        <property name="jobClass" value="es.caib.gdib.schedulejobs.ExpurgateDocumentsJob"/>
        <property name="jobDataAsMap">
            <map>
                <entry key="jobExecuter" value-ref="expurgateDocuments"/>
            </map>
        </property>
    </bean>

	<bean id="expurgateDocumentsPlaceHolderPopertiesFilter" class="es.caib.gdib.utils.FilterPlaceholderProperties">
		<constructor-arg index="0" type="String" value="expurgate"/>
		<property name="ignoreUnresolvablePlaceholders">
			<value>true</value>
		</property>
		<property name="locations">
		        <list>
		        	<value>classpath:alfresco/module/gdib-amp/properties/schedule-job-expurgate.properties</value>
		        	<value>classpath*:schedule-job-expurgate.properties</value>
		        </list>
    		</property>
	</bean>

    <!-- Fin Expurgate Documents -->
</beans>
